# USB官方文档链接

https://www.usb.org/documents

# USB1.0低速设备

```mermaid
stateDiagram-v2
    [*] --> 闲置\n【J状态】
    
    闲置\n【J状态】 --> 传输\n【持续发送J状态和K状态若干bit时间】 : 开发者决定
    传输\n【持续发送J状态和K状态若干bit时间】 --> EOP\n【在SE0持续2bit时间】\n【在J状态持续1bit时间】
    EOP\n【在SE0持续2bit时间】\n【在J状态持续1bit时间】 --> 闲置\n【J状态】
    
    闲置\n【J状态】 --> 复位信号\n【在SE0状态持续10ms】 : 开发者决定
    复位信号\n【在SE0状态持续10ms】 --> 闲置\n【J状态】
    
    闲置\n【J状态】 --> 挂起信号\n【在SE0状态持续3ms】 : 开发者决定
    挂起信号\n【在SE0状态持续3ms】 --> 闲置\n【J状态】
    
    闲置\n【J状态】 --> 保持活动信号\n【在SE0持续2bit时间】\n【在J状态持续1bit时间】 : 开发者决定
    保持活动信号\n【在SE0持续2bit时间】\n【在J状态持续1bit时间】 --> 闲置\n【J状态】
```

# USB1.0全速设备

```mermaid
stateDiagram-v2
    [*] --> 闲置\n【J状态】
    
    闲置\n【J状态】 --> SOP\n【在K状态持续1bit时间】 : 开发者决定
    SOP\n【在K状态持续1bit时间】 --> 传输\n【持续发送J状态和K状态若干bit时间】
    传输\n【持续发送J状态和K状态若干bit时间】 --> EOP\n【在SE0持续2bit时间】\n【在J状态持续1bit时间】
    EOP\n【在SE0持续2bit时间】\n【在J状态持续1bit时间】 --> 闲置\n【J状态】
    
    闲置\n【J状态】 --> 复位信号\n【在SE0状态持续10ms】 : 开发者决定
    复位信号\n【在SE0状态持续10ms】 --> 闲置\n【J状态】
    
    闲置\n【J状态】 --> 挂起信号\n【在SE0状态持续3ms】 : 开发者决定
    挂起信号\n【在SE0状态持续3ms】 --> 闲置\n【J状态】
    
    闲置\n【J状态】 --> 保持活动信号\n【在SE0持续2bit时间】\n【在J状态持续1bit时间】 : 开发者决定
    保持活动信号\n【在SE0持续2bit时间】\n【在J状态持续1bit时间】 --> 闲置\n【J状态】
```

# USB1.0编码情况

```mermaid
stateDiagram-v2
    逻辑信号\n【逻辑0，逻辑1】 --> 标志状态\n【J状态，K状态】 : NRZI+BP\n输入(当前逻辑信号，上一时刻逻辑信号)\n输出(当前标志状态)
    标志状态\n【J状态，K状态】 --> 基本状态\n【D0状态，D1状态，SE0状态】 : 低速总线和全速总线映射不同\n输入(当前标志状态)\n输出(当前基本状态)
    基本状态\n【D0状态，D1状态，SE0状态】 --> 电平格式\n【V_H，V_L】 : 输入(当前基本状态)\n输出(当前D+电平格式，当前D-电平格式)
```

# 例题

渲染网站：https://wavedrom.com/editor.html

```wavedorm
{
  signal: [
  	{
      name: 'clk(实际没有)', 
      wave:"=================",
    },
    
    {
      name: 'D+', 
      wave: 'h.lh......lhl.h..',
    },
    
    {
      name: 'D-', 
      wave: 'l.hl......hl.....'
    },
    
    {
      name: '基本状态', 
      wave: '=================', 
      data: ['D1', 'D1', 'D0', 'D1', 'D1', 'D1', 'D1', 'D1', 'D1', 'D1', 'D0', 'D1', 'SE0', 'SE0', 'D1', 'D1', 'D1'],
    },
    
    {
      name: '标志状态', 
      wave: '=================', 
      data: ['J', 'J', 'K', 'J', 'J', 'J', 'J', 'J', 'J', 'J', 'K', 'J', 'SE0', 'SE0', 'J', 'J', 'J'],
    },
    
    {
      name: '总线状态', 
      wave: '3.45........7..3.', 
      data: ['闲置', 'SOP', '传输', 'EOP', '闲置']
    },
    
    {
      name: '传输数据', 
      wave: 'xxx=========xxxxx', 
      data: [0, 1, 1, 1, 1, 1, 1, 'BP', 0],
    },
]}

```

# 打印机举例

```mermaid
stateDiagram-v2
    USB设备\n【多功能打印机】 --> 配置0\n【外供电全功能模式】
    	配置0\n【外供电全功能模式】 --> 接口0.0\n【打印功能】
    		接口0.0\n【打印功能】 --> 端点0.0.0\n【接收打印文档数据】
    		接口0.0\n【打印功能】 --> 端点0.0.1\n【报告打印机状态】
    	配置0\n【外供电全功能模式】 --> 接口0.1\n【扫描功能】
    		接口0.1\n【扫描功能】 --> 端点0.1.0\n【报告扫描文档数据】
    		接口0.1\n【扫描功能】 --> 端点0.1.1\n【报告打印机状态】
    	配置0\n【外供电全功能模式】 --> 接口0.3\n【存储功能】
    		接口0.3\n【存储功能】 --> 端点0.3.0\n【读写存储数据】
    USB设备\n【多功能打印机】 --> 配置1\n【总线供电基本功能模式】
    	配置1\n【总线供电基本功能模式】 --> 接口1.0\n【打印功能】
    		接口1.0\n【打印功能】 --> 端点1.0.0\n【接收打印文档数据】
    		接口1.0\n【打印功能】 --> 端点1.0.1\n【报告打印机状态】
```

